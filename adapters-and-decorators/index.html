<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link as=font crossorigin href=https://wendajiang.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://wendajiang.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 rel=preload type=font/woff2><link href=https://wendajiang.github.io/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>Adapters and Decorators | 「靡不有初，鲜克有终」</title><meta content="adapters and decorator pattern" name=description><link href=https://wendajiang.github.io/adapters-and-decorators/ rel=canonical><meta content="Adapters and Decorators" property=og:title><meta content="adapters and decorator pattern" property=og:description><meta content=article property=og:type><meta content=https://wendajiang.github.io/adapters-and-decorators/ property=og:url><meta content=https://wendajiang.github.io/david.png property=og:image><meta content=2023-03-20T13:18:47 property=og:updated_time><meta content="Adapters and Decorators" property=og:site_name><meta content=en_US property=og:locale><script type=application/ld+json>
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/adapters-and-decorators/"
      },
      "headline": "Adapters and Decorators",
      "image": ,
      "datePublished": "2023-03-20T13:18:47",
      "dateModified": "2023-03-20T13:18:47",
      "author": {
        "@type": "Organization",
        "name": "Adapters and Decorators"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Adapters and Decorators",
        
        "logo": {
          "@type": "ImageObject",
          "url": "/david.png"
        }
        
      },
      "description": "adapters and decorator pattern"
    }
    </script><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://wendajiang.github.io/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Adapters And Decorators",
            "item": "https://wendajiang.github.io/adapters-and-decorators/"
          },
        
      
    
  }
</script><meta content=#fff name=theme-color><link href=https://wendajiang.github.io/david.png rel=apple-touch-icon sizes=180x180><link href=https://wendajiang.github.io/david.png rel=icon sizes=32x32 type=image/png><link href=https://wendajiang.github.io/david.png rel=icon sizes=16x16 type=image/png><link crossorigin href=https://wendajiang.github.io/site.webmanifest rel=manifest><link href=https://wendajiang.github.io/rss.xml rel=alternate title=RSS type=application/rss+xml><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq rel=stylesheet><script crossorigin defer integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script crossorigin defer integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI onload=renderMathInElement(document.body); src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script>function initMermaid(){var a={startOnLoad:true,theme:"neutral",flowchart:{useMaxWidth:true,htmlLabels:true}};mermaid.initialize(a);window.mermaid.init(undefined,document.querySelectorAll('.mermaid'))}</script><script async onload=initMermaid() src=https://cdn.jsdelivr.net/npm/mermaid@latest/dist/mermaid.min.js></script><body class="blog single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" id=menu-btn type=checkbox><label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://wendajiang.github.io>「靡不有初，鲜克有终」</a><button aria-label="Toggle mode" class="btn btn-link order-2 order-md-4" id=mode type=button><span class=toggle-dark><svg class="feather feather-moon" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span> <span class=toggle-light><svg class="feather feather-sun" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=5></circle><line x1=12 x2=12 y1=1 y2=3></line><line x1=12 x2=12 y1=21 y2=23></line><line x1=4.22 x2=5.64 y1=4.22 y2=5.64></line><line x1=18.36 x2=19.78 y1=18.36 y2=19.78></line><line x1=1 x2=3 y1=12 y2=12></line><line x1=21 x2=23 y1=12 y2=12></line><line x1=4.22 x2=5.64 y1=19.78 y2=18.36></line><line x1=18.36 x2=19.78 y1=5.64 y2=4.22></line></svg></span></button><ul class="navbar-nav fork-me order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/wendajiang><svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/books/effective-modern-cpp/>Books</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/turtle/>Turtle</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/essay/>Essay</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/QA/>Q&A</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/tags>Tags</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/archive>Archive</a></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container" role=document><div class=content><div class="row justify-content-center"><nav aria-label="Secondary navigation" class="books-toc d-none d-xl-block col-xl-3"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=https://wendajiang.github.io/adapters-and-decorators/#the-decorator-pattern>the decorator pattern</a></li><ul><li><a href=https://wendajiang.github.io/adapters-and-decorators/#the-classic-decorator-pattern-limitation>the classic decorator pattern limitation</a><li><a href=https://wendajiang.github.io/adapters-and-decorators/#decorators-the-c-way>Decorators the C++ way</a></ul><li><a href=https://wendajiang.github.io/adapters-and-decorators/#adapter-pattern>adapter pattern</a></li><ul><li><a href=https://wendajiang.github.io/adapters-and-decorators/#compile-time-adapters>compile-time adapters</a></ul></ul></nav></div></nav><div class="col-md-12 col-lg-10 col-xxl-8"><article><div class=blog-header><h1>Adapters and Decorators</h1><p><small>Posted 2023-03-20 13:18:47 ‐ <strong>4 min read</strong></small><p><div class=category-area>「 <a href="https://wendajiang.github.io/tags/design pattern"> <div class=category>design pattern</div> </a> 」</div></div><h1 id=the-decorator-pattern><a aria-label="Anchor link for: the-decorator-pattern" class=zola-anchor href=#the-decorator-pattern>the decorator pattern</a></h1><blockquote><p>structural pattern, it allows a behavior to be added to an object<p>The decorator implements the interface of the original class and forwards the requests from its own interface to that class, but it also performs additional actions before and after these forwarded requests -- these are the <em>decorations</em>.</blockquote><pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=color:#6272a4>// original class
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Unit </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>    </span><span style=color:#50fa7b>Unit</span><span>(</span><span style=font-style:italic;color:#8be9fd>double </span><span style=font-style:italic;color:#ffb86c>strength</span><span>, </span><span style=font-style:italic;color:#8be9fd>double </span><span style=font-style:italic;color:#ffb86c>armor</span><span>): </span><span style=color:#fff>strength_</span><span>(strength), </span><span style=color:#fff>armor_</span><span>(armor) </span><span style=color:#fff>{}
</span><span>    </span><span style=color:#ff79c6>virtual </span><span style=font-style:italic;color:#8be9fd>bool </span><span style=color:#50fa7b>hit</span><span>(Unit</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>target</span><span>) </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return </span><span style=color:#50fa7b>attack</span><span>() </span><span style=color:#ff79c6>></span><span> target</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>defense</span><span>(); </span><span style=color:#fff>}
</span><span>    </span><span style=color:#ff79c6>virtual </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>attack</span><span>() </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>0</span><span>;
</span><span>    </span><span style=color:#ff79c6>virtual </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>defense</span><span>() </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>0</span><span>;
</span><span>  </span><span style=color:#ff79c6>protected</span><span>:
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double</span><span> strength_;
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double</span><span> armor_;
</span><span style=color:#fff>}</span><span>;
</span><span>
</span><span style=color:#6272a4>// concrete class of Unit
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Knight</span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Unit </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>    </span><span style=color:#ff79c6>using</span><span> Unit</span><span style=color:#ff79c6>::</span><span>Unit;
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>attack</span><span>() </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return</span><span> strength_ </span><span style=color:#ff79c6>+</span><span> sword_bonus_; </span><span style=color:#fff>}
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>defense</span><span>() </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return</span><span> armor_ </span><span style=color:#ff79c6>+</span><span> plate_bonus_; </span><span style=color:#fff>}
</span><span>  </span><span style=color:#ff79c6>protected</span><span>:
</span><span>    </span><span style=color:#ff79c6>static constexpr </span><span style=font-style:italic;color:#8be9fd>double</span><span> sword_bonus_ </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>2</span><span>;
</span><span>    </span><span style=color:#ff79c6>static constexpr </span><span style=font-style:italic;color:#8be9fd>double</span><span> plate_bonus_ </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>3</span><span>;
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Ogre</span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Unit </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>attack</span><span>() </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return</span><span> strength_ </span><span style=color:#ff79c6>+</span><span> club_penalty_; </span><span style=color:#fff>}     
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>defense</span><span>() </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return</span><span> armor_ </span><span style=color:#ff79c6>+</span><span> leather_penalty_; </span><span style=color:#fff>}
</span><span>  </span><span style=color:#ff79c6>protected</span><span>:
</span><span>    </span><span style=color:#ff79c6>static constexpr </span><span style=font-style:italic;color:#8be9fd>double</span><span> club_penalty_ </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>2</span><span>;
</span><span>    </span><span style=color:#ff79c6>static constexpr </span><span style=font-style:italic;color:#8be9fd>double</span><span> leather_penalty_ </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>3</span><span>; 
</span><span style=color:#fff>}</span><span>;
</span><span>
</span><span>
</span><span style=color:#6272a4>// use 
</span><span>Knight </span><span style=color:#50fa7b>k</span><span>(</span><span style=color:#bd93f9>10</span><span>, </span><span style=color:#bd93f9>5</span><span>);
</span><span>Ogre </span><span style=color:#50fa7b>o</span><span>(</span><span style=color:#bd93f9>12</span><span>, </span><span style=color:#bd93f9>2</span><span>);
</span><span>k</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>hit</span><span>(</span><span style=color:#bd93f9>0</span><span>); </span><span style=color:#6272a4>// yes!
</span></code></pre><p>Here the knight, aided by his attack bonus and the enemy's weak armor, will successfully hit the ogre. But the game is far from over. As the units fight, the surviving ones gain experience and eventually become veterans. A veteran unit is still the same kind of unit, but it gains attack and defense bonuses, reflecting its combat experience.<p>We do not want to change any of the class interfaces, but we want to modify the behavior of the <code>attack()</code> and <code>defense()</code> functions. This is the job of the decorator pattern, and what follows is the classic implementation of the VeteranUnit decorator:<pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>VeteranUnit </span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Unit </span><span style=color:#fff>{     
</span><span>  </span><span style=color:#ff79c6>public</span><span>:     
</span><span>    </span><span style=color:#50fa7b>VeteranUnit</span><span>(Unit</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>unit</span><span>, </span><span style=font-style:italic;color:#8be9fd>double </span><span style=font-style:italic;color:#ffb86c>strength_bonus</span><span>, </span><span style=font-style:italic;color:#8be9fd>double </span><span style=font-style:italic;color:#ffb86c>armor_bonus</span><span>) :
</span><span>        </span><span style=color:#fff>Unit</span><span>(strength_bonus, armor_bonus), </span><span style=color:#fff>unit_</span><span>(unit) </span><span style=color:#fff>{}     
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>attack</span><span>() </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return</span><span> unit_</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>attack</span><span>() </span><span style=color:#ff79c6>+</span><span> strength_; </span><span style=color:#fff>}     
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>defense</span><span>() </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return</span><span> unit_</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>defense</span><span>() </span><span style=color:#ff79c6>+</span><span> armor_; </span><span style=color:#fff>}     
</span><span>  </span><span style=color:#ff79c6>private</span><span>:     
</span><span>    Unit</span><span style=color:#ff79c6>&</span><span> unit_; 
</span><span style=color:#fff>}</span><span>;
</span><span>
</span><span style=color:#6272a4>// use
</span><span>Knight </span><span style=color:#50fa7b>k</span><span>(</span><span style=color:#bd93f9>10</span><span>, </span><span style=color:#bd93f9>5</span><span>);
</span><span>Ogre </span><span style=color:#50fa7b>o</span><span>(</span><span style=color:#bd93f9>12</span><span>, </span><span style=color:#bd93f9>2</span><span>);
</span><span>VeteranUnit </span><span style=color:#50fa7b>vk</span><span>(</span><span style=font-style:italic;color:#ffb86c>k</span><span>, </span><span style=color:#bd93f9>7</span><span>, </span><span style=color:#bd93f9>2</span><span>);
</span><span>VeteranUnit </span><span style=color:#50fa7b>vo</span><span>(</span><span style=font-style:italic;color:#ffb86c>o</span><span>, </span><span style=color:#bd93f9>1</span><span>, </span><span style=color:#bd93f9>9</span><span>);
</span><span>vk</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>hit</span><span>(vo); </span><span style=color:#6272a4>// another hit!
</span><span>
</span><span>VeteranUnit </span><span style=color:#50fa7b>vvo</span><span>(</span><span style=font-style:italic;color:#ffb86c>vo</span><span>, </span><span style=color:#bd93f9>1</span><span>, </span><span style=color:#bd93f9>9</span><span>);
</span><span>vk</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>hit</span><span>(voo); </span><span style=color:#6272a4>// miss
</span><span style=color:#6272a4>// we can decorate a decorated object in this design!
</span></code></pre><h2 id=the-classic-decorator-pattern-limitation><a aria-label="Anchor link for: the-classic-decorator-pattern-limitation" class=zola-anchor href=#the-classic-decorator-pattern-limitation>the classic decorator pattern limitation</a></h2><ul><li>the lifetimes of these objects must be carefully managed<li>to C++ <ul><li>when designer have added a special ability to the Knight unit, but the VeteranUnit decorator do not know the added ability can't handle cross-casting well(casting to a type in another branch of the same hierarchy)</ul></ul><h2 id=decorators-the-c-way><a aria-label="Anchor link for: decorators-the-c-way" class=zola-anchor href=#decorators-the-c-way>Decorators the C++ way</a></h2><p>To solve the two problem, we indorduct the CRTP C++ idiom<pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>template </span><span><</span><span style=font-style:italic;color:#8be9fd>typename</span><span> U> 
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>VeteranUnit </span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>U </span><span style=color:#fff>{     
</span><span>  </span><span style=color:#ff79c6>public</span><span>:     
</span><span>    </span><span style=color:#50fa7b>VeteranUnit</span><span>(U</span><span style=color:#ff79c6>&& </span><span style=font-style:italic;color:#ffb86c>unit</span><span>, </span><span style=font-style:italic;color:#8be9fd>double </span><span style=font-style:italic;color:#ffb86c>strength_bonus</span><span>, </span><span style=font-style:italic;color:#8be9fd>double </span><span style=font-style:italic;color:#ffb86c>armor_bonus</span><span>) :         
</span><span>      </span><span style=color:#fff>U</span><span>(unit), </span><span style=color:#fff>strength_bonus_</span><span>(strength_bonus), </span><span style=color:#fff>armor_bonus_</span><span>(armor_bonus)     </span><span style=color:#fff>{}     
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>attack</span><span>() </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return </span><span>U</span><span style=color:#ff79c6>::</span><span style=color:#50fa7b>attack</span><span>() </span><span style=color:#ff79c6>+</span><span> strength_bonus_; </span><span style=color:#fff>}     
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double </span><span style=color:#50fa7b>defense</span><span>() </span><span style=color:#fff>{ </span><span style=color:#ff79c6>return </span><span>U</span><span style=color:#ff79c6>::</span><span style=color:#50fa7b>defense</span><span>() </span><span style=color:#ff79c6>+</span><span> armor_bonus_; </span><span style=color:#fff>}     
</span><span>  </span><span style=color:#ff79c6>private</span><span>:     
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double</span><span> strength_bonus_;     
</span><span>    </span><span style=font-style:italic;color:#8be9fd>double</span><span> armor_bonus_; 
</span><span style=color:#fff>}</span><span>;
</span><span>
</span><span style=color:#6272a4>// using
</span><span>Knight </span><span style=color:#50fa7b>k</span><span>(</span><span style=color:#bd93f9>10</span><span>, </span><span style=color:#bd93f9>5</span><span>); 
</span><span>Ogre </span><span style=color:#50fa7b>o</span><span>(</span><span style=color:#bd93f9>12</span><span>, </span><span style=color:#bd93f9>2</span><span>); 
</span><span>k</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>hit</span><span>(o);        </span><span style=color:#6272a4>// Hit! 
</span><span>VeteranUnit&LTKnight> </span><span style=color:#50fa7b>vk</span><span>(std</span><span style=color:#ff79c6>::</span><span style=color:#50fa7b>move</span><span>(k), </span><span style=color:#bd93f9>7</span><span>, </span><span style=color:#bd93f9>2</span><span>); 
</span><span>VeteranUnit&LTOgre> </span><span style=color:#50fa7b>vo</span><span>(std</span><span style=color:#ff79c6>::</span><span style=color:#50fa7b>move</span><span>(o), </span><span style=color:#bd93f9>1</span><span>, </span><span style=color:#bd93f9>9</span><span>); vk</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>hit</span><span>(vo);      </span><span style=color:#6272a4>// Hit! 
</span><span>VeteranUnit&LTVeteranUnit&LTOgre>> </span><span style=color:#50fa7b>vvo</span><span>(std</span><span style=color:#ff79c6>::</span><span style=color:#50fa7b>move</span><span>(vo), </span><span style=color:#bd93f9>1</span><span>, </span><span style=color:#bd93f9>9</span><span>); 
</span><span>vk</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>hit</span><span>(vvo);     </span><span style=color:#6272a4>// Miss...
</span><span>vk</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>charge</span><span>();     </span><span style=color:#6272a4>// Compiles now, vk is a Knight too , this is the Knight added ability, and now is ok
</span><span>vk</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>hit</span><span>(vvo);     </span><span style=color:#6272a4>// Hit with the charge bonus!
</span></code></pre><p>This preservation of the interface is a fundamental feature of the Decorator pattern. It is also one of its most serious limitations.<h1 id=adapter-pattern><a aria-label="Anchor link for: adapter-pattern" class=zola-anchor href=#adapter-pattern>adapter pattern</a></h1><p>It is a sturctural pattern that allows an interface of a class to be used as another, different interface. It allows an existing class to be used in code that expects a different interface, without modifying the original class.<p>Adapter is very general, broad pattern. It can be used to implement several other, more narrowly defined patterns -- in particular, the decorator.<p>Converting an object from its current interface to the interface needed by a particular application, without rewriting the object itself, is the purpose and the use of the Adapter pattern.<ul><li>class adapter<li>function adapter (std::bind)</ul><h2 id=compile-time-adapters><a aria-label="Anchor link for: compile-time-adapters" class=zola-anchor href=#compile-time-adapters>compile-time adapters</a></h2></article></div></div></div><div id=gitalk-container></div><link href=https://unpkg.com/gitalk/dist/gitalk.css rel=stylesheet><script src=https://unpkg.com/gitalk/dist/gitalk.min.js></script><script>var gitalk=new Gitalk({id:'Adapters and Decorators',clientID:'a17500877ddbb2dd70b9',clientSecret:'77e1c5816e97e2473c0a617bd0e3ece99f33559f',repo:'wendajiang.github.io',owner:'wendajiang',admin:['wendajiang'],perPage:50});gitalk.render('gitalk-container')</script></div><script defer src=https://wendajiang.github.io/js/main.js></script><script defer src=https://wendajiang.github.io/plugins/elasticlunr.min.js></script><script defer src=https://wendajiang.github.io/search_index.en.js></script><script defer src=https://wendajiang.github.io/js/search.js></script>