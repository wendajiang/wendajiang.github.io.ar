<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link as=font crossorigin href=https://wendajiang.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 rel=preload type=font/woff2><link as=font crossorigin href=https://wendajiang.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 rel=preload type=font/woff2><link href=https://wendajiang.github.io/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>visitor pattern | 「靡不有初，鲜克有终」</title><meta content="blog of david" name=description><link href=https://wendajiang.github.io/visitor/ rel=canonical><meta content="visitor pattern" property=og:title><meta content="blog of david" property=og:description><meta content=article property=og:type><meta content=https://wendajiang.github.io/visitor/ property=og:url><meta content=https://wendajiang.github.io/david.png property=og:image><meta content=2024-04-06T21:36:41 property=og:updated_time><meta content="visitor pattern" property=og:site_name><meta content=en_US property=og:locale><script type=application/ld+json>
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/visitor/"
      },
      "headline": "visitor pattern",
      "image": ,
      "datePublished": "2024-04-06T21:36:41",
      "dateModified": "2024-04-06T21:36:41",
      "author": {
        "@type": "Organization",
        "name": "visitor pattern"
      },
      "publisher": {
        "@type": "Organization",
        "name": "visitor pattern",
        
        "logo": {
          "@type": "ImageObject",
          "url": "/david.png"
        }
        
      },
      "description": "blog of david"
    }
    </script><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://wendajiang.github.io/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Visitor",
            "item": "https://wendajiang.github.io/visitor/"
          },
        
      
    
  }
</script><meta content=#fff name=theme-color><link href=https://wendajiang.github.io/david.png rel=apple-touch-icon sizes=180x180><link href=https://wendajiang.github.io/david.png rel=icon sizes=32x32 type=image/png><link href=https://wendajiang.github.io/david.png rel=icon sizes=16x16 type=image/png><link crossorigin href=https://wendajiang.github.io/site.webmanifest rel=manifest><link href=https://wendajiang.github.io/rss.xml rel=alternate title=RSS type=application/rss+xml><link crossorigin href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq rel=stylesheet><script crossorigin defer integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script crossorigin defer integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI onload=renderMathInElement(document.body); src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script>function initMermaid(){var a={startOnLoad:true,theme:"neutral",flowchart:{useMaxWidth:true,htmlLabels:true}};mermaid.initialize(a);window.mermaid.init(undefined,document.querySelectorAll('.mermaid'))}</script><script async onload=initMermaid() src=https://cdn.jsdelivr.net/npm/mermaid@latest/dist/mermaid.min.js></script><body class="blog single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" id=menu-btn type=checkbox><label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://wendajiang.github.io>「靡不有初，鲜克有终」</a><button aria-label="Toggle mode" class="btn btn-link order-2 order-md-4" id=mode type=button><span class=toggle-dark><svg class="feather feather-moon" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span> <span class=toggle-light><svg class="feather feather-sun" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=5></circle><line x1=12 x2=12 y1=1 y2=3></line><line x1=12 x2=12 y1=21 y2=23></line><line x1=4.22 x2=5.64 y1=4.22 y2=5.64></line><line x1=18.36 x2=19.78 y1=18.36 y2=19.78></line><line x1=1 x2=3 y1=12 y2=12></line><line x1=21 x2=23 y1=12 y2=12></line><line x1=4.22 x2=5.64 y1=19.78 y2=18.36></line><line x1=18.36 x2=19.78 y1=5.64 y2=4.22></line></svg></span></button><ul class="navbar-nav fork-me order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/wendajiang><svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/books/effective-modern-cpp/>Books</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/turtle/>Turtle</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/essay/>Essay</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/QA/>Q&A</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/tags>Tags</a><li class=nav-item><a class=nav-link href=https://wendajiang.github.io/archive>Archive</a></ul><div class="break order-6 d-md-none"></div></div></div></header><div class="wrap container" role=document><div class=content><div class="row justify-content-center"><nav aria-label="Secondary navigation" class="books-toc d-none d-xl-block col-xl-3"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=https://wendajiang.github.io/visitor/#what-is-visitor-pattern>what is visitor pattern</a><li><a href=https://wendajiang.github.io/visitor/#why-we-need-visitor-pattern>why we need visitor pattern</a><li><a href=https://wendajiang.github.io/visitor/#visitor-pattern>visitor pattern</a></li><ul><li><a href=https://wendajiang.github.io/visitor/#visit-complex-objects>visit complex objects</a></ul></ul></nav></div></nav><div class="col-md-12 col-lg-10 col-xxl-8"><article><div class=blog-header><h1>visitor pattern</h1><p><small>Posted 2024-04-06 21:36:41 ‐ <strong>4 min read</strong></small><p><div class=category-area>「 <a href=https://wendajiang.github.io/tags/visitor> <div class=category>visitor</div> </a><a href="https://wendajiang.github.io/tags/design pattern"> <div class=category>design pattern</div> </a> 」</div></div><h1 id=what-is-visitor-pattern><a aria-label="Anchor link for: what-is-visitor-pattern" class=zola-anchor href=#what-is-visitor-pattern>what is visitor pattern</a></h1><p>A pattern that separates the algorithm from the object structure, which is the data for the algorithm. Using the visitor pattern, we can add a new operation to the class hierarchy without modifying the classes themselves.<p>Different, more technical way to describe the visitor pattern is to say that it implements <em>double dispatch</em>. Let's explain the term.<pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Base </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>virtual </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>f</span><span>() </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>0</span><span>;
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>D1 </span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Base </span><span style=color:#fff>{
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>f</span><span>() </span><span style=color:#ff79c6>override</span><span>;
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>D2</span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Base </span><span style=color:#fff>{
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>f</span><span>() </span><span style=color:#ff79c6>override</span><span>;
</span><span style=color:#fff>}</span><span>;
</span></code></pre><p>The regular virtual function calls, if we invoke the <code>b->f()</code> virtual function through a pointer to the base class, the call is dispatched to <code>D1::f()</code> or <code>D2::f()</code>, depending on the real type of the object. This is the <strong>single dispatch</strong>. Now let's assume that the function <code>f()</code> also take an argument that is the pointer to a base class:<pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Base </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>virtual </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>f</span><span>(Base </span><span style=color:#ff79c6>*</span><span style=font-style:italic;color:#ffb86c>p</span><span>) </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>0</span><span>;
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>D1 </span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Base </span><span style=color:#fff>{
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>f</span><span>(Base </span><span style=color:#ff79c6>*</span><span style=font-style:italic;color:#ffb86c>p</span><span>) </span><span style=color:#ff79c6>override</span><span>;
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>D2</span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Base </span><span style=color:#fff>{
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>f</span><span>(Base </span><span style=color:#ff79c6>*</span><span style=font-style:italic;color:#ffb86c>p</span><span>) </span><span style=color:#ff79c6>override</span><span>;
</span><span style=color:#fff>}</span><span>;
</span></code></pre><p>This would be <strong>double dispatch</strong>.<h1 id=why-we-need-visitor-pattern><a aria-label="Anchor link for: why-we-need-visitor-pattern" class=zola-anchor href=#why-we-need-visitor-pattern>why we need visitor pattern</a></h1><p>Why would we want to add an operation externally instaed of implementing it in every class in herarchy class-tree? Consider the example of the serialization/deserialization problem.<p>For example, we may need to write an object into a memory buffer, to be transmitted across the network and decerialized on another machine. Alternatively, we may need to save the object to disk, or else we may need to convert all objects in a container to a markup format such as JSON.<ol><li>The straighforward approach would have us add a serialization and a deserialization method to every object for every serialization machanism. If a new and different serialization approach is needed, we have to go over the entire class hierarchy and add support for it.<li>An alternative is to implement the entire serialization/deserialization operation in a separate function that can handle all classes. The resulting code is a loop that iterates over all objects, with a large decision tree inside of it. The code must interrogate every object and determine its type, for example, using dynamic casts. When a new class is added to the hierarchy, all serialization and deserialization implementations must be updated to handle the new objects.</ol><p>Both are difficult to maintain for large hierarchies. The visitor pattern offers a solution.<h1 id=visitor-pattern><a aria-label="Anchor link for: visitor-pattern" class=zola-anchor href=#visitor-pattern>visitor pattern</a></h1><pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Pet </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>  </span><span style=color:#ff79c6>virtual </span><span style=color:#50fa7b>~Pet</span><span>() </span><span style=color:#fff>{}
</span><span>  </span><span style=color:#50fa7b>Pet</span><span>(std</span><span style=color:#ff79c6>::</span><span>string</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>color</span><span>): </span><span style=color:#fff>color_</span><span>(color) </span><span style=color:#fff>{}
</span><span>  </span><span style=color:#ff79c6>const</span><span> std</span><span style=color:#ff79c6>:</span><span>string</span><span style=color:#ff79c6>& </span><span style=color:#50fa7b>color</span><span>() </span><span style=color:#ff79c6>const </span><span style=color:#fff>{
</span><span>    </span><span style=color:#ff79c6>return</span><span> color_;
</span><span>  </span><span style=color:#fff>}
</span><span>  </span><span style=color:#ff79c6>private</span><span>: 
</span><span>  </span><span style=color:#ff79c6>const</span><span> std</span><span style=color:#ff79c6>::</span><span>string color_;
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Cat</span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Pet </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>  </span><span style=color:#50fa7b>Cat</span><span>(std</span><span style=color:#ff79c6>::</span><span>string</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>color</span><span>): </span><span style=color:#fff>Pet</span><span>(color) </span><span style=color:#fff>{}
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Dog</span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>Pet </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>  </span><span style=color:#50fa7b>Dog</span><span>(std</span><span style=color:#ff79c6>::</span><span>string</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>color</span><span>): </span><span style=color:#fff>Pet</span><span>(color) </span><span style=color:#fff>{}
</span><span style=color:#fff>}</span><span>;
</span></code></pre><p>Now we want to add some operations to ousr classes, such as "feed the pet" or "play with the pet"<pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Cat</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Dog</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>PetVisitor </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>  </span><span style=color:#ff79c6>virtual </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>visitor</span><span>(Cat</span><span style=color:#ff79c6>* </span><span style=font-style:italic;color:#ffb86c>c</span><span>) </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>0</span><span>;
</span><span>  </span><span style=color:#ff79c6>virtual </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>visitor</span><span>(Dog</span><span style=color:#ff79c6>* </span><span style=font-style:italic;color:#ffb86c>d</span><span>) </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>0</span><span>;
</span><span style=color:#fff>}</span><span>;
</span></code></pre><p>We need to make the <code>Pet</code> hierarchy visitable, which means we do need to modify it, but only once, regradless of how many operations we want to add later.<pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Pet </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>  </span><span style=color:#ff79c6>virtual </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>accept</span><span>(PetVisitor</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>v</span><span>) </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>0</span><span>;
</span><span>  </span><span style=color:#ff79c6>...
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Cat </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>accept</span><span>(PetVisitor</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>v</span><span>) </span><span style=color:#ff79c6>override </span><span style=color:#fff>{
</span><span>    v</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>visit</span><span>(</span><span style=color:#bd93f9>this</span><span>);
</span><span>  </span><span style=color:#fff>}
</span><span>  </span><span style=color:#ff79c6>...
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>Dog </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>:
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>accept</span><span>(PetVisitor</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>v</span><span>) </span><span style=color:#ff79c6>override </span><span style=color:#fff>{
</span><span>    v</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>visit</span><span>(</span><span style=color:#bd93f9>this</span><span>);
</span><span>  </span><span style=color:#fff>}
</span><span>  </span><span style=color:#ff79c6>...
</span><span style=color:#fff>}</span><span>;
</span></code></pre><p>Now out <code>Pet</code> hierarchy is visitable, and we have an abstract <code>PetVisitor</code> class. Everything is ready to implement new operations for our classes.<pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>FeedingVisitor</span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>PetVisitor </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>: 
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>visit</span><span>(Cat </span><span style=color:#ff79c6>*</span><span style=font-style:italic;color:#ffb86c>c</span><span>) </span><span style=color:#ff79c6>override </span><span style=color:#fff>{
</span><span>    std</span><span style=color:#ff79c6>::</span><span>cout </span><span style=color:#ff79c6><< </span><span style=color:#f1fa8c>"Feeding to the " </span><span style=color:#ff79c6><<</span><span> c</span><span style=color:#ff79c6>-></span><span style=color:#50fa7b>color</span><span>() </span><span style=color:#ff79c6><< </span><span style=color:#f1fa8c>"cat" </span><span style=color:#ff79c6><<</span><span> std</span><span style=color:#ff79c6>::</span><span>endl;
</span><span>  </span><span style=color:#fff>}
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>visit</span><span>(Dog </span><span style=color:#ff79c6>*</span><span style=font-style:italic;color:#ffb86c>d</span><span>) </span><span style=color:#ff79c6>override </span><span style=color:#fff>{
</span><span>    std</span><span style=color:#ff79c6>::</span><span>cout </span><span style=color:#ff79c6><< </span><span style=color:#f1fa8c>"Feeding to the " </span><span style=color:#ff79c6><<</span><span> d</span><span style=color:#ff79c6>-></span><span style=color:#50fa7b>color</span><span>() </span><span style=color:#ff79c6><< </span><span style=color:#f1fa8c>"dog" </span><span style=color:#ff79c6><<</span><span> std</span><span style=color:#ff79c6>::</span><span>endl;
</span><span>  </span><span style=color:#fff>}
</span><span style=color:#fff>}</span><span>;
</span><span style=font-style:italic;color:#8be9fd>class </span><span style=text-decoration:underline;color:#8be9fd>PlayingVisitor</span><span>: </span><span style=color:#ff79c6>public </span><span style=text-decoration:underline;font-style:italic;color:#8be9fd>PetVisitor </span><span style=color:#fff>{
</span><span>  </span><span style=color:#ff79c6>public</span><span>: 
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>visit</span><span>(Cat </span><span style=color:#ff79c6>*</span><span style=font-style:italic;color:#ffb86c>c</span><span>) </span><span style=color:#ff79c6>override </span><span style=color:#fff>{
</span><span>    std</span><span style=color:#ff79c6>::</span><span>cout </span><span style=color:#ff79c6><< </span><span style=color:#f1fa8c>"Playing with the " </span><span style=color:#ff79c6><<</span><span> c</span><span style=color:#ff79c6>-></span><span style=color:#50fa7b>color</span><span>() </span><span style=color:#ff79c6><< </span><span style=color:#f1fa8c>"cat" </span><span style=color:#ff79c6><<</span><span> std</span><span style=color:#ff79c6>::</span><span>endl;
</span><span>  </span><span style=color:#fff>}
</span><span>  </span><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>visit</span><span>(Dog </span><span style=color:#ff79c6>*</span><span style=font-style:italic;color:#ffb86c>d</span><span>) </span><span style=color:#ff79c6>override </span><span style=color:#fff>{
</span><span>    std</span><span style=color:#ff79c6>::</span><span>cout </span><span style=color:#ff79c6><< </span><span style=color:#f1fa8c>"Playing with the " </span><span style=color:#ff79c6><<</span><span> d</span><span style=color:#ff79c6>-></span><span style=color:#50fa7b>color</span><span>() </span><span style=color:#ff79c6><< </span><span style=color:#f1fa8c>"dog" </span><span style=color:#ff79c6><<</span><span> std</span><span style=color:#ff79c6>::</span><span>endl;
</span><span>  </span><span style=color:#fff>}
</span><span style=color:#fff>}</span><span>;
</span></code></pre><p>The call <code>accept()</code> ends up dispatched to a particular <code>visit()</code> function based on two factors - the type of the visitable <code>*p</code> object and the type of the <code>*v</code> visitor. Stress the aspect of the visitor pattern, we can write code like this:<pre class=language-cpp data-lang=cpp style=background:#282a36;color:#f8f8f2><code class=language-cpp data-lang=cpp><span style=font-style:italic;color:#8be9fd>void </span><span style=color:#50fa7b>dispatch</span><span>(Pet</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>p</span><span>, PetVisitor</span><span style=color:#ff79c6>& </span><span style=font-style:italic;color:#ffb86c>v</span><span>) </span><span style=color:#fff>{
</span><span>  p</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>accept</span><span>(v);
</span><span style=color:#fff>}
</span><span>std</span><span style=color:#ff79c6>::</span><span>unique_ptr&LTPet> p </span><span style=color:#ff79c6>= ...</span><span>;
</span><span>std</span><span style=color:#ff79c6>::</span><span>unique_ptr&LTPetVisitor> v </span><span style=color:#ff79c6>= ...</span><span>;
</span><span style=color:#50fa7b>display</span><span>(</span><span style=color:#ff79c6>*</span><span>p, </span><span style=color:#ff79c6>*</span><span>v); </span><span style=color:#6272a4>// double dispatch
</span></code></pre><h2 id=visit-complex-objects><a aria-label="Anchor link for: visit-complex-objects" class=zola-anchor href=#visit-complex-objects>visit complex objects</a></h2><p>The correct way to handle the component objects is to simply visit each one, and thus delegate the problem to someone else.</article></div></div></div><div id=gitalk-container></div><link href=https://unpkg.com/gitalk/dist/gitalk.css rel=stylesheet><script src=https://unpkg.com/gitalk/dist/gitalk.min.js></script><script>var gitalk=new Gitalk({id:'visitor pattern',clientID:'a17500877ddbb2dd70b9',clientSecret:'77e1c5816e97e2473c0a617bd0e3ece99f33559f',repo:'wendajiang.github.io',owner:'wendajiang',admin:['wendajiang'],perPage:50});gitalk.render('gitalk-container')</script></div><script defer src=https://wendajiang.github.io/js/main.js></script><script defer src=https://wendajiang.github.io/plugins/elasticlunr.min.js></script><script defer src=https://wendajiang.github.io/search_index.en.js></script><script defer src=https://wendajiang.github.io/js/search.js></script>